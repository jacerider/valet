"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return a};var a={},t=Object.prototype,u=t.hasOwnProperty,s=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function i(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{i({},"")}catch(t){i=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o,i,a,c,e=e&&e.prototype instanceof h?e:h,e=Object.create(e.prototype),r=new _(r||[]);return s(e,"_invoke",{value:(o=t,i=n,a=r,c="suspendedStart",function(t,e){if("executing"===c)throw new Error("Generator is already running");if("completed"===c){if("throw"===t)throw e;return L()}for(a.method=t,a.arg=e;;){var n=a.delegate;if(n){n=function t(e,n){var r=n.method,o=e.iterator[r];if(void 0===o)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=void 0,t(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;r=l(o,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,f;o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,f):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}(n,a);if(n){if(n===f)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===c)throw c="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);c="executing";n=l(o,i,a);if("normal"===n.type){if(c=a.done?"completed":"suspendedYield",n.arg===f)continue;return{value:n.arg,done:a.done}}"throw"===n.type&&(c="completed",a.method="throw",a.arg=n.arg)}})}),e}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}a.wrap=c;var f={};function h(){}function p(){}function d(){}var e={},y=(i(e,r,function(){return this}),Object.getPrototypeOf),y=y&&y(y(E([]))),v=(y&&y!==t&&u.call(y,r)&&(e=y),d.prototype=h.prototype=Object.create(e));function m(t){["next","throw","return"].forEach(function(e){i(t,e,function(t){return this._invoke(e,t)})})}function g(a,c){var e;s(this,"_invoke",{value:function(n,r){function t(){return new c(function(t,e){!function e(t,n,r,o){var i,t=l(a[t],a,n);if("throw"!==t.type)return(n=(i=t.arg).value)&&"object"==_typeof(n)&&u.call(n,"__await")?c.resolve(n.__await).then(function(t){e("next",t,r,o)},function(t){e("throw",t,r,o)}):c.resolve(n).then(function(t){i.value=t,r(i)},function(t){return e("throw",t,r,o)});o(t.arg)}(n,r,t,e)})}return e=e?e.then(t,t):t()}})}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function b(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function E(e){if(e){var n,t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(u.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=t}return{next:L}}function L(){return{value:void 0,done:!0}}return s(v,"constructor",{value:p.prototype=d,configurable:!0}),s(d,"constructor",{value:p,configurable:!0}),p.displayName=i(d,o,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,i(t,o,"GeneratorFunction")),t.prototype=Object.create(v),t},a.awrap=function(t){return{__await:t}},m(g.prototype),i(g.prototype,n,function(){return this}),a.AsyncIterator=g,a.async=function(t,e,n,r,o){void 0===o&&(o=Promise);var i=new g(c(t,e,n,r),o);return a.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},m(v),i(v,o,"Generator"),i(v,r,function(){return this}),i(v,"toString",function(){return"[object Generator]"}),a.keys=function(t){var e,n=Object(t),r=[];for(e in n)r.push(e);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},a.values=E,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function t(t,e){return i.type="throw",i.arg=n,r.next=t,e&&(r.method="next",r.arg=void 0),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&u.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}var i=(o=o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc?null:o)?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),b(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,r,o=this.tryEntries[e];if(o.tryLoc===t)return"throw"===(n=o.completion).type&&(r=n.arg,b(o)),r}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},a}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var __awaiter=function(t,a,c,u){return new(c=c||Promise)(function(n,e){function r(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?n(t.value):((e=t.value)instanceof c?e:new c(function(t){t(e)})).then(r,o)}i((u=u.apply(t,a||[])).next())})};new(function(){function t(){var e=this;_classCallCheck(this,t),this.isOpen=!1,this.keysPressed={},this.onResults=function(t){setTimeout(function(){e.autoCompleteJS.goTo(0)})},this.onSelection=function(t){t=t.detail.selection.value;"string"==typeof t.url&&e.go(t.url)},this.getData=function(){return __awaiter(e,void 0,void 0,_regeneratorRuntime().mark(function t(){var e,n,r;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=this.$element.dataset.cacheId,n=localStorage?JSON.parse(localStorage.getItem("exoValet")):null,localStorage&&null!==n&&(r=localStorage.getItem("exoValetCacheId"),e!==r)&&(localStorage.setItem("exoValetCacheId",e),n=null),null===n)return t.next=7,this.fetchData().then(function(t){var e=JSON.stringify(t);return e!==JSON.stringify({})&&localStorage.setItem("exoValet",e),t});t.next=11;break;case 7:return r=t.sent,t.abrupt("return",r);case 11:return t.abrupt("return",n);case 12:t.next=17;break;case 14:return t.prev=14,t.t0=t.catch(0),t.abrupt("return",t.t0);case 17:case"end":return t.stop()}},t,this,[[0,14]])}))},this.fetchData=function(){return __awaiter(e,void 0,void 0,_regeneratorRuntime().mark(function t(){var e;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(drupalSettings.path.baseUrl+"api/valet");case 3:return e=t.sent,t.next=6,e.json();case 6:return e=t.sent,t.abrupt("return",e);case 10:return t.prev=10,t.t0=t.catch(0),t.abrupt("return",t.t0);case 13:case"end":return t.stop()}},t,null,[[0,10]])}))},this.isEditableElement=function(t){return!!(t instanceof HTMLElement&&t.isContentEditable)||(t instanceof HTMLInputElement&&/|text|email|number|password|search|tel|url/.test(t.type||"")||t instanceof HTMLTextAreaElement)&&!(t.disabled||t.readOnly)},this.$element=document.getElementById("valet"),this.$input=document.getElementById("valet--input"),this.$close=document.getElementById("valet--close"),this.bind(),this.build()}return _createClass(t,[{key:"bind",value:function(){var e=this;document.addEventListener("keydown",function(t){e.keysPressed[t.key]=!0,e.keysPressed.Shift&&e.keysPressed[" "]&&(e.isEditableElement(document.activeElement)||(t.preventDefault(),e.open())),!0===e.isOpen&&e.keysPressed.Escape&&(t.preventDefault(),e.close())}),document.addEventListener("keyup",function(t){delete e.keysPressed[t.key]}),this.$element.addEventListener("click",function(t){t.preventDefault(),t.target===e.$element&&e.close()}),this.$close.addEventListener("click",function(t){t.preventDefault(),e.close()})}},{key:"build",value:function(){this.autoCompleteJS=new autoComplete({selector:"#valet--input",data:{src:this.getData,cache:!0,filter:function(t){return t.filter(function(e,t,n){return n.findIndex(function(t){return t.value.url===e.value.url})===t})},keys:["label","tags"]},threshold:1,debounce:50,resultsList:{element:function(t,e){var n=document.createElement("p");n.classList.add("overview"),0<e.results.length?n.innerHTML="Displaying <strong>".concat(e.results.length,"</strong> out of <strong>").concat(e.matches.length,"</strong> results"):n.innerHTML="Found <strong>".concat(e.matches.length,'</strong> matching results for <strong>"').concat(e.query,'"</strong>'),t.append(n)},noResults:!0,maxResults:6,tabSelect:!0},resultItem:{element:function(t,e){"autoComplete_result_0"===t.id&&t.setAttribute("aria-selected",!0),t.innerHTML='\n            <span class="title">\n              <span class="icon '.concat(e.value.icon,'"></span>\n              ').concat(e.value.label,'\n            </span>\n            <span class="description">\n              ').concat(e.value.description,'\n            </span>\n            <span class="url">\n              ').concat(e.value.url.split("?")[0],"\n            </span>")},highlight:!0}}),this.autoCompleteJS.input.addEventListener("results",this.onResults),this.autoCompleteJS.input.addEventListener("selection",this.onSelection)}},{key:"go",value:function(t){t=t.replace("RETURN_URL",window.location.pathname.substring(1)),this.keysPressed.Shift?(this.close(),window.open(t)):(this.$input.setAttribute("placeholder","Please wait..."),this.$input.value="",this.$input.disabled=!0,window.location=t)}},{key:"open",value:function(){var t=this;this.isOpen=!0,this.$element.classList.add("valet--active"),this.$input.value="",setTimeout(function(){t.$input.focus()},300)}},{key:"close",value:function(){this.isOpen=!1,this.$element.classList.remove("valet--active")}}]),t}());
//# sourceMappingURL=valet.js.map
